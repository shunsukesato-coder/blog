<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>SCVMM サーバーおよび SCVMM 管理対象サーバーの自己署名証明書の更新手順 | Japan System Center Support Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="皆さんこんにちは、System Center サポートチームの 保科と申します。 今回は、System Center Virtual Machine Manager (SCVMM) で使用する自己署名証明書の有効期限が切れた場合や、削除をされた場合の対処方法についてご案内いたします。 [本ページが対象とする SCVMM バージョン]SCVMM 2012SCVMM 2012 SP1SCVMM 20">
<meta property="og:type" content="article">
<meta property="og:title" content="SCVMM サーバーおよび SCVMM 管理対象サーバーの自己署名証明書の更新手順">
<meta property="og:url" content="https://jpsystemcenter.github.io/blog/SCVMM/SCVMM_Renew_Crtificate/index.html">
<meta property="og:site_name" content="Japan System Center Support Blog">
<meta property="og:description" content="皆さんこんにちは、System Center サポートチームの 保科と申します。 今回は、System Center Virtual Machine Manager (SCVMM) で使用する自己署名証明書の有効期限が切れた場合や、削除をされた場合の対処方法についてご案内いたします。 [本ページが対象とする SCVMM バージョン]SCVMM 2012SCVMM 2012 SP1SCVMM 20">
<meta property="og:locale" content="ja_JP">
<meta property="article:published_time" content="2022-01-12T03:00:00.000Z">
<meta property="article:modified_time" content="2022-04-14T04:29:49.524Z">
<meta property="article:author" content="Japan System Center Support">
<meta property="article:tag" content="Agent">
<meta property="article:tag" content="SCVMM">
<meta property="article:tag" content="HowTo">
<meta property="article:tag" content="Library Server">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="../../atom.xml" title="Japan System Center Support Blog" type="application/atom+xml">
  

  <link rel="icon" href="../../favicon.ico">
  <link rel="apple-touch-icon" sizes="180x180" href="../../apple-touch-icon.png">
  <link rel="icon" type="image/png" sizes="32x32" href="../../favicon-32x32.png">
  <link rel="icon" type="image/png" sizes="16x16" href="../../favicon-16x16.png">
  <link rel="manifest" href="../../site.webmanifest">
  <link rel="mask-icon" href="../../safari-pinned-tab.svg" color="#5bbad5">
  <meta name="msapplication-TileColor" content="#ffffff">
  <meta name="theme-color" content="#ffffff">
  
    <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  
  
<link rel="stylesheet" href="../../css/style.css">

<meta name="generator" content="Hexo 5.4.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="site-header-logo"></div>
  <div id="site-header-blog-wrapper"></div>
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        <div id="ms-logo"></div>
        
          <a class="main-nav-link" href="/blog/">Home</a>
        
          <a class="main-nav-link" href="/blog/archives">Archives</a>
        
        <a class="main-nav-link" target="_blank" rel="noopener" href="https://cssjpn.github.io/">サポート情報</a>
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="../../atom.xml" title="RSSフィード"></a>
        
      </nav>
      <div id="search-form-wrap">
        <form action="//www.bing.com/search" method="get" accept-charset="UTF-8" name="bing-search" onsubmit="var f=this;if(f['q'].value){var searchUrl =  'https://www.bing.com/search?q=' +  encodeURIComponent(f['q'].value + ' site:' + f['sitesearch'].value) ;window.open(searchUrl, 'blank') };return false;" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="検索"><button type="submit" id="nav-search-btn" class="search-form-submit"></button><input type="hidden" name="sitesearch" value="https://jpsystemcenter.github.io/blog"></form>
      </div>
    </div>
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="../../index.html" id="logo">Japan System Center Support Blog</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="../../index.html" id="subtitle">日本マイクロソフトの System Center に関するサポート情報のブログです。</a>
        </h2>
      
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main"><article id="post-SCVMM/SCVMM_Renew_Crtificate" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
    
      <header class="article-header-single">
        
  
    <h1 class="article-title" itemprop="name">
      SCVMM サーバーおよび SCVMM 管理対象サーバーの自己署名証明書の更新手順
    </h1>
  

      </header>
      <div class="article-share">
        Last Update: 
        <a href="" class="article-date-single">
  <time datetime="2022-01-12T03:00:00.000Z" itemprop="datePublished">2022-01-12</time>
</a>
        
        
        <a href="https://github.com/jpsystemcenter/issues/new?title=&body=%0A%0A---%0A%0A%23%23%23%23+Document+Details%0A%0A%E2%9A%A0+*Do+not+edit+this+section.%0A%0A*+ID%3A+99daa8e7-4f6b-5816-9c39-28197034f087%0A*+%E5%AF%BE%E8%B1%A1%E8%A8%98%E4%BA%8B%3A+%5BSCVMM+%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%8A%E3%82%88%E3%81%B3+SCVMM+%E7%AE%A1%E7%90%86%E5%AF%BE%E8%B1%A1%E3%82%B5%E3%83%BC%E3%83%90%E3%83%BC%E3%81%AE%E8%87%AA%E5%B7%B1%E7%BD%B2%E5%90%8D%E8%A8%BC%E6%98%8E%E6%9B%B8%E3%81%AE%E6%9B%B4%E6%96%B0%E6%89%8B%E9%A0%86%5D%28https%3A%2F%2Fjpsystemcenter.github.io%2Fblog%2FSCVMM%2FSCVMM_Renew_Crtificate%2F%29%0A*+Content+Source%3A+%5Barticles%2FSCVMM%2FSCVMM_Renew_Crtificate.md%5D%28https%3A%2F%2Fgithub.com%2Fjpsystemcenter%2Fblob%2Fmain%2Farticles%2FSCVMM%2FSCVMM_Renew_Crtificate.md%29%0A*+Author%3A+" class="article-github-issue-link" target="_blank" rel="noopener noreferrer">feedback</a>
        
        <a data-url="https://jpsystemcenter.github.io/blog/SCVMM/SCVMM_Renew_Crtificate/" data-id="cl1yi610q00060os319mxg662" class="article-share-link">共有</a>
      </div>
    
    <div class="article-entry" itemprop="articleBody">
      
        <span id="more"></span>
<p>皆さんこんにちは、System Center サポートチームの 保科と申します。</p>
<p>今回は、System Center Virtual Machine Manager (SCVMM) で使用する自己署名証明書の有効期限が切れた場合や、削除をされた場合の対処方法についてご案内いたします。</p>
<h3 id="本ページが対象とする-SCVMM-バージョン"><a href="#本ページが対象とする-SCVMM-バージョン" class="headerlink" title="[本ページが対象とする SCVMM バージョン]"></a>[本ページが対象とする SCVMM バージョン]</h3><p>SCVMM 2012<br>SCVMM 2012 SP1<br>SCVMM 2012 R2<br>SCVMM 2016<br>SCVMM 2019</p>
<h3 id="概要"><a href="#概要" class="headerlink" title="[概要]"></a>[概要]</h3><p>SCVMM では、SCVMM サーバー機能をインストールしたサーバーや、SCVMM にて管理対象となる Hyper-V サーバーに SCVMM エージェントがインストールされた際、同時に自己署名証明書も当該サーバーにインストールされます。<br>これは、SCVMM サーバーと管理対象 Hyper-V サーバーの間の通信の安全性を確保するためにインストールされます。<br>そのため、この自己署名証明書は、SCVMM サーバーが管理対象 Hyper-V サーバーと通信を行う際に必須となる証明書となります。</p>
<p>この自己署名証明書は、フレンドリ名が  “SCVMM_CERTIFICATE_KEY_CONTAINER***” となっており、発行者はそのホスト自身になっています。<br>(*** の部分は SCVMM サーバーもしくは Hyper-V サーバーの完全修飾ドメイン名となります。)<br>この証明書の期限は SCVMM サーバーや、Hyper-V サーバーを SCVMM の管理対象に設定した年の 1/1 から 5 年間に設定されます。<br>例えば 2015/10/26 に Hyper-V ホストを SCVMM の管理対象に設定した場合、設定される証明書の有効期限は 2020/1/1 になります。<br>これは 2015 年中であればいつ Hyper-Vホストを管理対象に追加された場合でも同様の結果となります。</p>
<p>上記の通りこの証明書の期限は 5 年間 (SCVMM のバージョンによっては 10 年間)となっています。<br>このため、5 年間 (10 年間) が経過するとこの証明書は無効になります。<br>なお、この証明書の有効期限が超過する 1 ヶ月前になりますと、SCVMM サーバー上で以下の警告メッセージが出力されるようになります。</p>
<blockquote>
<p>警告 (20583)<br>コンピューター &lt;対象サーバーの完全修飾ドメイン名&gt; の自己署名証明書は既に有効期限切れか、1 か月以内に有効期限切れになります。</p>
<p>推奨される操作<br>VMM から &lt;対象サーバーの完全修飾ドメイン名&gt; を削除してから追加して、新しい証明書を取得してください。</p>
</blockquote>
<p>また何かのトラブルシュートの際などに誤ってこの証明書を削除してしまったりすることも考えられます。<br>その場合、SCVMM サーバーと Hyper-V サーバーの間の通信に問題が発生し、Hyper-V サーバーの管理作業などが正しく動作しなくなります。</p>
<p>このような場合、SCVMM サーバーもしくは Hyper-V サーバーにインストールされている SCVMM エージェントを再インストールすることで対処することもできますが、証明書を再発行することでも対処することができます。<br>この際の手順は以下の [対処手順 ①] に従って自己署名証明書の再インストールを実施します。<br>また、SCVMM サーバー限定かつ特定の SCVMM バージョン限定の手順とはなりますが、[対処手順 ②] に従った自己署名証明書の更新も実施いただけます。</p>
<h3 id="対処手順-①"><a href="#対処手順-①" class="headerlink" title="[対処手順 ①]"></a>[対処手順 ①]</h3><ol>
<li>自己署名証明書を更新いただくサーバーに管理者権限でログインします。</li>
<li>Windows + R を入力して、[ファイル名を指定して実行] を起動します。</li>
<li>mmc と入力して [OK] をクリックします。</li>
<li>表示されたウインドウで、メニュー バーから [ファイル] - [スナップインの追加と削除] を選択します。</li>
<li>“利用できるスナップイン” から “証明書” を選択し、[追加] をクリックします。</li>
<li>[証明書スナップイン] ウインドウが表示されたら、”コンピューター アカウント” をチェックし、[次へ] をクリックします。</li>
<li>[コンピューターの選択] ウインドウでは、既定値のまま [完了] をクリックします。</li>
<li>[OK] をクリックして、[スナップインの追加と削除] ウインドウを閉じます。</li>
<li>左側のツリーから、[証明書 (ローカル コンピューター)] -&gt; [個人] -&gt; [証明書] を開きます。</li>
<li>中央ペインに表示されている証明書のうち、”フレンドリ名” 列に “SCVMM_CERTIFICATE_KEY_CONTAINER***” と表示されてる証明書を選択して削除します。<br>(*** の部分は SCVMM サーバーもしくは Hyper-V サーバーの完全修飾ドメイン名となります。)<br>そのような証明書が既に存在しない場合、そのまま手順 11. に進みます。</li>
<li>SCVMM サーバー上で、”Virtual Machine Manager Command Shell” を起動します。</li>
<li>以下のコマンドを実行します。<blockquote>
<p><code> </code> <code>$credential = get-credential</code> <code> </code></p>
</blockquote>
</li>
<li>表示されたウインドウに、SCVMM サーバーのローカル管理者権限のあるユーザーのユーザー名とパスワードを入力して [OK] をクリックします。</li>
<li>続いて、以下のコマンドを実行します。<br>(*** の部分は SCVMM サーバーもしくは Hyper-V サーバーの完全修飾ドメイン名を入力します。)<blockquote>
<p><code> </code> <code>Get-VMMManagedComputer -ComputerName &quot;***&quot; | Register-SCVMMManagedComputer  -Credential $credential</code> <code> </code></p>
</blockquote>
</li>
<li>自己署名証明書を更新されるサーバーに、有効期限が 5 年後 (10 年後) の 1 月 1 日に設定された自己署名証明書が無事再作成されたことを、10. の手順で開いたコンソール上で確認いただきます。<br>手順実施後も証明書が更新されていない場合、画面を最新の情報に更新いただくことで表示される場合がございます。</li>
</ol>
<h3 id="対処手順-②"><a href="#対処手順-②" class="headerlink" title="[対処手順 ②]"></a>[対処手順 ②]</h3><p>こちらの手順は、以下の SCVMM バージョンにて追加されたコマンドレットを使用する手順となります。<br>・SCVMM 2016 Update Rollup 10<br>・SCVMM 2019 Update Rollup 2<br>上記のバージョンに SCVMM をアップデートすると、SCVMM サーバーの自己署名証明書を更新する “Update-SCVMMCertificate” コマンドレットがご利用いただけるようになります。<br>SCVMM サーバー限定の手順となり、Hyper-V サーバーに対しては実施いただけない手順となりますが、以下の手順に沿って SCVMM サーバーにインストールされた自己署名証明書を更新いただけます。</p>
<ol>
<li>SCVMM サーバーに管理者権限でログインします。</li>
<li>ログインしたサーバー上で “Virtual Machine Manager Command Shell” を起動します。</li>
<li>以下のコマンドを実行します。<blockquote>
<p><code> </code> <code>Update-SCVMMCertificate -VMMServer &#39;***&#39; </code> <code> </code><br><code> </code> <code> (*** の部分は SCVMM サーバーの完全修飾ドメイン名を入力します。)</code> <code> </code></p>
</blockquote>
</li>
<li>自己署名証明書を更新されるサーバーに、有効期限が 5 年後 (10 年後) の 1 月 1 日に設定された自己署名証明書が無事再作成されたことを、”対処手順 ①” の 10. の手順で開けるコンソール上で確認いただきます。<br>手順実施後も証明書が更新されていない場合、画面を最新の情報に更新いただくことで表示される場合がございます。</li>
</ol>

      
      
        <div class="article-disclaimer">
        
          <p>※本情報の内容（添付文書、リンク先などを含む）は、作成日時点でのものであり、予告なく変更される場合があります。</p>
        
        </div>
      
    </div>
    <footer class="article-footer">
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Agent/" rel="tag">Agent</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/HowTo/" rel="tag">HowTo</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/Library-Server/" rel="tag">Library Server</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="../../tags/SCVMM/" rel="tag">SCVMM</a></li></ul>

        
        <a href="https://github.com/jpsystemcenter/edit/main/articles/SCVMM/SCVMM_Renew_Crtificate.md" class="article-github-edit-link" target="_blank" rel="noopener noreferrer">GitHub で編集</a>
        
    </footer>
  </div>
  
    
<nav id="article-nav">
  
    <a href="../../SCOM/SCOM_agent_failures/" id="article-nav-newer" class="article-nav-link-wrap">
      <strong class="article-nav-caption">次の記事</strong>
      <div class="article-nav-title">
        
          SCOM エージェントの入れ替え作業の失敗事例
        
      </div>
    </a>
  
  
    <a href="../../SCOM/SCOM_AccessError_0x00000005/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">前の記事</strong>
      <div class="article-nav-title">AdtAdmin / setquery でアクセス拒否エラー(0x00000005)が発生する場合の対処法</div>
    </a>
  
</nav>

  
</article>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">最近の投稿</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="../../general/JapanSCEM_000_NewBlogOpened/">Japan System Center Enterprise Management (SCEM) チームの Blog 新規開設のお知らせ</a>
          </li>
        
          <li>
            <a href="../../general/Prerequisites_SQL2019/">一部の System Center 2019 で SQL Server 2019 を使用する際の前提条件</a>
          </li>
        
          <li>
            <a href="../../SCOM/SCOM_2012R2_Uninstall-TroubleCase/">SCOM 2012 R2 エージェントのアンインストール時のトラブル事例</a>
          </li>
        
          <li>
            <a href="../../SCOM/SCOM_agent_failures/">SCOM エージェントの入れ替え作業の失敗事例</a>
          </li>
        
          <li>
            <a href="">SCVMM サーバーおよび SCVMM 管理対象サーバーの自己署名証明書の更新手順</a>
          </li>
        
      </ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグ</h3>
    <div class="widget">
      <!-- <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Agent/" rel="tag">Agent</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Audit-Collection-Service-ACS/" rel="tag">Audit Collection Service (ACS)</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/General/" rel="tag">General</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/HowTo/" rel="tag">HowTo</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Information/" rel="tag">Information</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Library-Server/" rel="tag">Library Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SCOM/" rel="tag">SCOM</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SCVMM/" rel="tag">SCVMM</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SQL-Server/" rel="tag">SQL Server</a></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/Troubleshoot/" rel="tag">Troubleshoot</a></li></ul>  -->
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SCOM/">SCOM</a><span class="tag-list-count">3</span><ul><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/SCOM/Agent">Agent</a><span class="tag-list-count">2</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/SCOM/Audit-Collection-Service-ACS">Audit Collection Service (ACS)</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/SCOM/Troubleshoot">Troubleshoot</a><span class="tag-list-count">3</span></li></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/SCVMM/">SCVMM</a><span class="tag-list-count">1</span><ul><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/SCVMM/Agent">Agent</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/SCVMM/HowTo">HowTo</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/SCVMM/Library-Server">Library Server</a><span class="tag-list-count">1</span></li></ul></li><li class="tag-list-item"><a class="tag-list-link" href="../../tags/General/">General</a><span class="tag-list-count">2</span><ul><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/General/HowTo">HowTo</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/General/Information">Information</a><span class="tag-list-count">1</span></li><li class="tag-list-item tag-list-item-child-tag"><a class="tag-list-link tag-list-link-child" href="../../tags/General/SQL-Server">SQL Server</a><span class="tag-list-count">1</span></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">アーカイブ</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/03/">2022 / 03</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/02/">2022 / 02</a></li><li class="archive-list-item"><a class="archive-list-link" href="../../archives/2022/01/">2022 / 01</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">タグクラウド</h3>
    <div class="widget tagcloud">
      <a href="../../tags/Agent/" style="font-size: 20px;">Agent</a> <a href="../../tags/Audit-Collection-Service-ACS/" style="font-size: 10px;">Audit Collection Service (ACS)</a> <a href="../../tags/General/" style="font-size: 15px;">General</a> <a href="../../tags/HowTo/" style="font-size: 15px;">HowTo</a> <a href="../../tags/Information/" style="font-size: 10px;">Information</a> <a href="../../tags/Library-Server/" style="font-size: 10px;">Library Server</a> <a href="../../tags/SCOM/" style="font-size: 20px;">SCOM</a> <a href="../../tags/SCVMM/" style="font-size: 10px;">SCVMM</a> <a href="../../tags/SQL-Server/" style="font-size: 10px;">SQL Server</a> <a href="../../tags/Troubleshoot/" style="font-size: 20px;">Troubleshoot</a>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2022 Japan System Center Support<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="../../index.html" class="mobile-nav-link">Home</a>
  
    <a href="../../archives" class="mobile-nav-link">Archives</a>
  
</nav>
    

<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


<script src="../../js/script.js"></script>




  </div>
</body>
</html>